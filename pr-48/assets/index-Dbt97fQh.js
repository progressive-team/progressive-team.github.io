(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function T(){"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()}function f(i){"Notification"in window&&Notification.permission==="granted"&&new Notification("알림",{body:i})}class p{constructor(e,t){this.name=e,this.keyword=t}}const o=Object.freeze({WORK:new p("일할 시간","work"),BREAK:new p("짧은 휴식","break"),LONG_BREAK:new p("긴 휴식","long-break")});class b{constructor(e,t,n,r,a){this.mainApp=e,this.timerDisplay=t,this.tabs=n,this.settingGuide=r,this.worker=a,this.workTime="25:00",this.breakTime="05:00",this.longBreakTime="15:00",this.totalCycle=1,this.currentCycle=1}changeState(e){this.mainApp.dataset.state=e.keyword,this.timerDisplay.textContent=this.getTime(e);for(const t of this.tabs)t.ariaSelected=t.dataset.keyword===e.keyword?"true":"false"}getTime(e){switch(e){case o.WORK:return this.workTime;case o.BREAK:return this.breakTime;case o.LONG_BREAK:return this.longBreakTime;default:throw new Error("Unknown state")}}isTimerRunning(){return this.mainApp.dataset.timerState==="running"}stopTimer(){this.worker.postMessage({command:"stop"}),this.mainApp.dataset.timerState="stopped"}resetTimer(){this.stopTimer(),this.currentCycle=this.totalCycle,this.changeState(o.WORK)}initTimer(){T(),this.currentCycle=this.totalCycle}startTimer(){const t=this.timerDisplay.textContent.split(":"),n=(parseInt(t[0])*60+parseInt(t[1]))*1e3;this.worker.postMessage({command:"start",duration:n}),this.mainApp.dataset.timerState="running",this.settingGuide.dataset.cycleContext=`${this.currentCycle}/${this.totalCycle}`}skipNextPhase(){this.stopTimer();const{state:e}=this.mainApp.dataset;let t=!1;switch(e){case"work":this.changeState(o.BREAK),f(`짧은 휴식 시작. 현재 주기: ${this.settingGuide.dataset.cycleContext}`),t=!0;break;case"break":this.currentCycle>1?(this.changeState(o.WORK),this.currentCycle--):(this.changeState(o.LONG_BREAK),f(`모든 주기 종료
긴 휴식 시작`)),t=!0;break;case"long-break":this.changeState(o.WORK),f("뽀모도로 종료");break;default:throw new Error("Unknown state")}t&&this.startTimer()}setTime(e,t,n,r){this.workTime=e,this.breakTime=t,this.longBreakTime=n,this.totalCycle=r,this.currentCycle=r}runByButton(e){switch(e){case"work":this.changeState(o.WORK);break;case"break":this.changeState(o.BREAK);break;case"long-break":this.changeState(o.LONG_BREAK);break;default:throw new Error("Unknown button text")}}setTimerDisplay(e){this.timerDisplay.textContent=e}}function g(i,e){return`${String(i).padStart(2,"0")}:${String(e).padStart(2,"0")}`}function S(i){let e=i.value.replace(/\D/g,"");if(!e){i.value="";return}let t=parseInt(e.slice(-2))||0,n=parseInt(e.slice(0,-2))||0;t>=60&&(n+=Math.floor(t/60),t=t%60),i.value=g(n,t)}const y=new Worker(new URL("/pr-48/assets/worker-BjDuBdh3.js",import.meta.url),{type:"module"}),c=document.querySelector(".timer-setting-modal"),l=document.getElementById("work-time"),u=document.getElementById("break-time"),m=document.getElementById("long-break-time"),d=document.getElementById("cycle"),v=document.querySelectorAll("#work-time, #break-time, #cycle, #long-break-time");v.forEach(i=>{i.addEventListener("blur",()=>{i.id!=="cycle"&&S(i)})});const k=document.querySelectorAll('.tab-list[role="tablist"] > [role="tab"]'),w=document.querySelector(".setting-guide"),s=new b(document.querySelector("main.app"),document.querySelector(".timer-display"),k,w,y);document.querySelector("#create-timer").addEventListener("click",()=>{c.hidden=!1});document.querySelector('button[aria-label="닫기"]').addEventListener("click",()=>{c.hidden=!0});l.value=s.workTime;u.value=s.breakTime;m.value=s.longBreakTime;d.value=s.totalCycle;k.forEach(i=>{i.addEventListener("click",()=>{i.ariaSelected!=="true"&&(s.runByButton(i.dataset.keyword),s.isTimerRunning()&&s.stopTimer())})});w.addEventListener("click",R);const B=document.getElementById("generateBtn");B.addEventListener("click",I);const E=document.querySelector(".start-button");E.addEventListener("click",()=>{s.isTimerRunning()?s.resetTimer():(s.initTimer(),s.startTimer())});function R(){s.isTimerRunning()||(c.dataset.mode="modify",c.hidden=!1)}function I(){l.value||(l.value="25:00"),u.value||(u.value="05:00"),m.value||(m.value="15:00"),d.value||(d.value="1");const i=l.value,e=u.value,t=m.value,n=d.value;if(i==="00:00"||e==="00:00"||t==="00:00"){alert("⚠️ 타이머 시간은 00:00일 수 없습니다!");return}if(isNaN(n)||!Number.isInteger(parseFloat(n))||parseInt(n)<=0){alert("⚠️ 주기는 0보다 큰 정수만 가능합니다!");return}const r=/^\d{2,}:\d{2}$/;if(!r.test(i)||!r.test(e)||!r.test(t)){alert("⚠️ 시간 형식이 잘못되었습니다. (예: 25:00)");return}document.querySelector(".timer-create-area").hidden=!0,c.hidden=!0,document.querySelector(".timer-active-area").hidden=!1,alert(`✅ 타이머 설정 완료!
활동: ${i}
휴식: ${e}
긴 휴식: ${t}
주기: ${parseInt(n)}`),s.setTime(i,e,t,n),s.changeState(o.WORK)}y.onmessage=i=>{const e=i.data.remaining,t=Math.max(0,Math.ceil(e/1e3)),n=Math.floor(t/60),r=t%60,a=g(n,r);s.setTimerDisplay(a),!(e>0)&&s.skipNextPhase()};
